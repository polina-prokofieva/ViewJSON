"use strict";class Search{constructor(e){this.searchResults={byKey:[],byValue:[]},this.resultClassName="searchResultItem",this.viewJson=e,this.searchResultsId="searchResultsMainBlock"}clickEventListener(e){if(/searchHeader/.test(e.target.className)){let t=e.target,s=t.nextElementSibling,i=s.className.split(" "),n=i.indexOf("jv-visible");-1===n?(i[i.length]="jv-visible",t.className+=" open"):(i.splice(n,1),t.className=t.className.replace(/\sopen/g,"")),s.className=i.join(" ")}}searchByKeyAndValue(e){e.preventDefault();let t=document.getElementsByName("search")[0].value.toLowerCase();this.viewJson.json&&"object"==typeof this.viewJson.json&&(Array.isArray(this.viewJson.json)?this.searchInArray(t,this.viewJson.json):this.searchInObject(t,this.viewJson.json)),this.renderSearchResults(),this.viewJson.addEvents()}searchInArray(e,t){for(let s=0;s<t.length;s++)t[s]&&"object"==typeof t[s]?Array.isArray(t[s])?this.searchInArray(e,t[s]):this.searchInObject(e,t[s]):-1!==t[s].toString().toLowerCase().indexOf(e)&&this.searchResults.byValue.push(t[s])}searchInObject(e,t){let s={};for(let i in t)-1!==i.toLowerCase().indexOf(e)&&(s[i]=t[i],this.searchResults.byKey.push(Object.assign({},s)),s={}),t[i]&&"object"==typeof t[i]?Array.isArray(t[i])?this.searchInArray(e,t[i]):this.searchInObject(e,t[i]):t[i]&&-1!==t[i].toString().toLowerCase().indexOf(e)&&(s[i]=t[i],this.searchResults.byValue.push(Object.assign({},s)),s={})}hideAllSearchResults(){this.searchResultsElements=this.searchResultsMainElement.getElementsByClassName(this.resultClassName);for(let e=0;e<this.searchResultsElements.length;e++)this.viewJson.hideAllJson(this.searchResultsElements[e])}generateTypeOfSearchResults(e,t){let s="";if(this[`searchHeader_${t}`]||(this[`searchHeader_${t}`]=document.createElement("h4")),this[`searchHeader_${t}`].className=`searchHeader${e.length?" open":" nothingFound"}`,this[`searchHeader_${t}`].innerHTML=`by ${t} (${e.length} found):`,this[`searchResults_${t}`]||(this[`searchResults_${t}`]=document.createElement("div")),this[`searchResults_${t}`].className="searchResults jv-visible",e.length>=1)for(let t=0;t<e.length;t++)s+=`<div class="${this.resultClassName}">${this.viewJson.jsonToHTML(e[t])}</div>`;else s+="<p> Nothing found </p>";this[`searchResults_${t}`].innerHTML=s}renderSearchResults(){this.searchHeader||(this.searchHeader=document.createElement("h3"),this.searchHeader.innerHTML="Search Results:"),this.generateTypeOfSearchResults(this.searchResults.byKey,"key"),this.generateTypeOfSearchResults(this.searchResults.byValue,"value"),this.searchResultsMainElement||(this.searchResultsMainElement=document.createElement("div"),this.searchResultsMainElement.id=this.searchResultsId,this.searchResultsMainElement.appendChild(this.searchHeader),this.searchResultsMainElement.appendChild(this.searchHeader_key),this.searchResultsMainElement.appendChild(this.searchResults_key),this.searchResultsMainElement.appendChild(this.searchHeader_value),this.searchResultsMainElement.appendChild(this.searchResults_value),this.searchResultsMainElement.addEventListener("click",this.clickEventListener),this.searchResultsMainElement.addEventListener("click",this.viewJson.clickEventListener)),0===this.viewJson.state&&(this.viewJson.el.replaceChild(this.searchResultsMainElement,this.viewJson.mainElement),this.viewJson.state=1),this.hideAllSearchResults()}reset(){this.searchResults.byKey=[],this.searchResults.byValue=[]}}class FormAction{constructor(e){this.id="viewJSONActions",this.opened=!0,this.viewJSON=e}createHideAllButton(){this.hideAllButton||(this.hideAllButton=document.createElement("input"),this.hideAllButton.id="hideAll",this.hideAllButton.type="button",this.hideAllButton.value="Hide All")}createSearchForm(){this.searchInput||(this.searchInput=document.createElement("input"),this.searchInput.name="search",this.searchButton=document.createElement("input"),this.searchButton.type="submit",this.searchButton.id="search",this.searchButton.value="Search",this.resetButton=document.createElement("input"),this.resetButton.type="button",this.resetButton.id="reset",this.resetButton.value="Reset")}addEvents(){let e=this;e.hideAllAction||(e.hideAllAction=function(t){t.preventDefault(),e.viewJSON.hideAll()}),e.searchAction||(e.searchAction=function(t){t.preventDefault(),e.viewJSON.search.reset(),e.viewJSON.search.searchByKeyAndValue(t)}),e.resetAction||(e.resetAction=function(t){e.viewJSON.search.reset(),e.viewJSON.generate()}),this.hideAllButton.addEventListener("click",this.hideAllAction),this.resetButton.addEventListener("click",this.resetAction),this.actionsElement.addEventListener("submit",this.searchAction)}clearEvents(){this.hideAllButton.removeEventListener("click",this.hideAllAction),this.resetButton.removeEventListener("click",this.resetAction),this.actionsElement.removeEventListener("submit",this.searchAction)}generate(){return this.actionsElement||(this.actionsElement=document.createElement("form"),this.actionsElement.id=this.id,this.createHideAllButton(),this.createSearchForm(),this.actionsElement.appendChild(this.hideAllButton),this.actionsElement.appendChild(this.resetButton),this.actionsElement.appendChild(this.searchButton),this.actionsElement.appendChild(this.searchInput)),this.actionsElement}}class ViewJSON{constructor(e=document.body,t="",s=""){this.el=e,this.mainId="viewJsonMainBlock";try{this.json=JSON.parse(t.replace(/\s/g,"")),this.settings=JSON.parse(s.replace(/\/\/.*\n/g,"")),this.search=new Search(this),this.form=new FormAction(this),this.state=0,this.root=this.settings.root||this.json}catch(e){this.errorMessage=e.message,console.error(e)}}clickEventListener(e){if(/key/.test(e.target.className)){let t=e.target.parentNode,s=t.className.split(" "),i=s.indexOf("jv-invisible");-1===i?(-1===(i=s.indexOf("jv-visible"))&&(i=s.length),s[i]="jv-invisible"):s[i]="jv-visible",t.className=s.join(" ")}}numberToHTML(e){return`<span class="number">${e}</span>`}stringToHTML(e){return`<span class="string"><span class="quot">"</span>${e}<span class="quot">"</span></span>`}dateToHTML(e){return`<span class="boolean">${new Date(e).toDateString()}</span>`}booleanToHTML(e){return`<span class="boolean">${this.settings.boolAppearence[+e]}</span>`}nullToHTML(){return`<span class="null">${settings.nullAppearence}</span>`}undefinedToHTML(e){return`<span class="undefined">${e}</span>`}objectToHTML(e){let t="";t+='<ul class="objectProperties">';for(let s in e){let i=s;if(-1===this.settings.hidePropertiesByKey.indexOf(i)&&-1===this.settings.hidePropertiesByValue.indexOf(e[i])){if(this.settings.formatCamelCase){let e=i.match(/((^[a-z])|[A-Z])[a-z]+/g);i=e?e.join(" "):i}t+=`<li>${this.jsonToHTML(e[s],i)}</li>`}}return t}arrayToHTML(e,t){let s="",i=e.filter(e=>-1===this.settings.hidePropertiesByValue.indexOf(e));return s+='<ul class="arrayElements">',this.settings.keysForArrays[t]?s+=i.map((e,s)=>{let i;return i=this.settings.keysForArrays[t].replace(/\{(\w|\.)+\}/g,function(t){let s=t.slice(1,-1).split("."),i=e[s[0]];for(let e=1;e<s.length;e++){if(!i[s[e]]){i="-";break}i=i[s[e]]}return i||"-"}),`<li class="element">${this.jsonToHTML(e,i)}</li>`}).join(""):s+=i.map((e,t)=>`<li class="element">${this.jsonToHTML(e,t)}</li>`).join(""),s+="</ul>"}arrayToTableHTML(e){let t="",s=e.filter(e=>-1===this.settings.hidePropertiesByValue.indexOf(e));t+='<table class="arrayElements">',t+="<thead><tr>";for(let e in s[0])-1===this.settings.hidePropertiesByKey.indexOf(e)&&(t+=`<th>${e}</th>`);return t+="</tr></thead>",t+="<tbody>",t+=s.map((e,t)=>{let s="<tr>";for(let t in e)-1===this.settings.hidePropertiesByKey.indexOf(t)&&(s+="<td>",e[t]&&"object"==typeof e[t]?s+="[Object]":s+=e[t]||this.settings.nullAppearence,s+="</td>");return s+="</tr>"}).join(""),t+="</tbody>",t+="</table>"}arrayToListHTML(e){}jsonToHTML(e=this.json,t){let s=typeof e,i="";if("object"===s){if(Array.isArray(e))s="array";else if(null===e&&(s="null",-1!==this.settings.hidePropertiesByValue.indexOf(null)))return i}else-1!==this.settings.dateAppearence.keys.indexOf(t)&&(s="date");return i+=`<div class="${s}">`,i+=void 0!==t?`<span class="key">${t}</span><span class="colon">:</span> `:"","array"===s?this.settings.arraysAsTable.includes(t)?i+=this.arrayToTableHTML(e):i+=this.arrayToHTML(e,t):i+=this[`${s}ToHTML`](e),i+="</div>"}hideObjectOrArray(e){let t=e.className.split(" "),s=t.indexOf("jv-invisible");-1===s&&(-1===(s=t.indexOf("jv-visible"))&&(s=t.length),t[s]="jv-invisible"),e.className=t.join(" ")}hideAllJson(e=this.mainElement){let t,s,i=e.children[0];t=i.getElementsByClassName("object"),s=i.getElementsByClassName("array");for(let e=0;e<t.length;e++)this.hideObjectOrArray(t[e]);for(let e=0;e<s.length;e++)this.hideObjectOrArray(s[e])}hideAll(){this.state?this.search.hideAllSearchResults():this.hideAllJson()}generateJSON(e=this.root){this.mainElement.innerHTML=this.jsonToHTML(e),this.state=0}generate(){!this.form.actionsElement&&this.settings.showSearchPanel&&(this.el.appendChild(this.form.generate()),this.form.addEvents()),this.state&&(this.el.replaceChild(this.mainElement,this.search.searchResultsMainElement),this.state=0),this.hideAll()}render(){if(this.settings.root){let e=this.settings.root.split("/");for(let t=0;t<e.length;t++)this.root=this.root[e[t]]}this.generateJSON(),this.generate(),this.el.appendChild(this.mainElement),this.addEvents()}start(){this.json?this.settings?(this.el.innerHTML="",this.mainElement=document.createElement("div"),this.mainElement.id=this.mainId,this.render()):this.el.innerHTML=`<div id="jsonParseError"><p>There is an error in settings json</p><p>Error message: ${this.errorMessage}</p></div>`:this.el.innerHTML=`<div id="jsonParseError"><p>There is an error in json file</p><p>Error message: ${this.errorMessage}</p></div>`}addEvents(){this.mainElement.addEventListener("click",this.clickEventListener)}clearEvents(){let e=this;e.mainElement&&e.mainElement.removeEventListener("click",e.clickEventListener)}clear(){this.el.innerHTML="",this.clearEvents(),delete this.mainElement,this.search&&delete this.search.searchResultsMainElement}}