"use strict";class Search{constructor(e){this.searchResults={byKey:[],byValue:[]},this.resultClassName="searchResultItem",this.viewJson=e,this.searchResultsId="searchResultsMainBlock"}clickEventListener(e){if(/searchHeader/.test(e.target.className)){let s=e.target,t=s.nextElementSibling,a=t.className.split(" "),h=a.indexOf("visible");-1===h?(a[a.length]="visible",s.className+=" open"):(a.splice(h,1),s.className=s.className.replace(/\sopen/g,"")),t.className=a.join(" ")}}searchByKeyAndValue(e){e.preventDefault();let s=document.getElementsByName("search")[0].value.toLowerCase();this.viewJson.json&&"object"==typeof this.viewJson.json&&(Array.isArray(this.viewJson.json)?this.searchInArray(s,this.viewJson.json):this.searchInObject(s,this.viewJson.json)),this.renderSearchResults(),this.viewJson.addEvents()}searchInArray(e,s){for(let t=0;t<s.length;t++)s[t]&&"object"==typeof s[t]?Array.isArray(s[t])?this.searchInArray(e,s[t]):this.searchInObject(e,s[t]):-1!==s[t].toString().toLowerCase().indexOf(e)&&this.searchResults.byValue.push(s[t])}searchInObject(e,s){let t={};for(let a in s)-1!==a.toLowerCase().indexOf(e)&&(t[a]=s[a],this.searchResults.byKey.push(Object.assign({},t)),t={}),s[a]&&"object"==typeof s[a]?Array.isArray(s[a])?this.searchInArray(e,s[a]):this.searchInObject(e,s[a]):s[a]&&-1!==s[a].toString().toLowerCase().indexOf(e)&&(t[a]=s[a],this.searchResults.byValue.push(Object.assign({},t)),t={})}hideAllSearchResults(){this.searchResultsElements=this.searchResultsMainElement.getElementsByClassName(this.resultClassName);for(let e=0;e<this.searchResultsElements.length;e++)this.viewJson.hideAllJson(this.searchResultsElements[e])}generateTypeOfSearchResults(e,s){let t="";if(this[`searchHeader_${s}`]||(this[`searchHeader_${s}`]=document.createElement("h4")),this[`searchHeader_${s}`].className=`searchHeader${e.length?" open":" nothingFound"}`,this[`searchHeader_${s}`].innerHTML=`by ${s} (${e.length} found):`,this[`searchResults_${s}`]||(this[`searchResults_${s}`]=document.createElement("div")),this[`searchResults_${s}`].className="searchResults visible",e.length>=1)for(let s=0;s<e.length;s++)t+=`<div class="${this.resultClassName}">${this.viewJson.jsonToHTML(e[s])}</div>`;else t+="<p> Nothing found </p>";this[`searchResults_${s}`].innerHTML=t}renderSearchResults(){this.searchHeader||(this.searchHeader=document.createElement("h3"),this.searchHeader.innerHTML="Search Results:"),this.generateTypeOfSearchResults(this.searchResults.byKey,"key"),this.generateTypeOfSearchResults(this.searchResults.byValue,"value"),this.searchResultsMainElement||(this.searchResultsMainElement=document.createElement("div"),this.searchResultsMainElement.id=this.searchResultsId,this.searchResultsMainElement.appendChild(this.searchHeader),this.searchResultsMainElement.appendChild(this.searchHeader_key),this.searchResultsMainElement.appendChild(this.searchResults_key),this.searchResultsMainElement.appendChild(this.searchHeader_value),this.searchResultsMainElement.appendChild(this.searchResults_value),this.searchResultsMainElement.addEventListener("click",this.clickEventListener),this.searchResultsMainElement.addEventListener("click",this.viewJson.clickEventListener)),0===this.viewJson.state&&(this.viewJson.el.replaceChild(this.searchResultsMainElement,this.viewJson.mainElement),this.viewJson.state=1),this.hideAllSearchResults()}reset(){this.searchResults.byKey=[],this.searchResults.byValue=[]}}
class FormAction{constructor(t){this.id="viewJSONActions",this.opened=!0,this.viewJSON=t}createHideAllButton(){this.hideAllButton||(this.hideAllButton=document.createElement("input"),this.hideAllButton.id="hideAll",this.hideAllButton.type="button",this.hideAllButton.value="Hide All")}createSearchForm(){this.searchInput||(this.searchInput=document.createElement("input"),this.searchInput.name="search",this.searchButton=document.createElement("input"),this.searchButton.type="submit",this.searchButton.id="search",this.searchButton.value="Search",this.resetButton=document.createElement("input"),this.resetButton.type="button",this.resetButton.id="reset",this.resetButton.value="Reset")}addEvents(){let t=this;t.hideAllAction||(t.hideAllAction=function(e){e.preventDefault(),t.viewJSON.hideAll()}),t.searchAction||(t.searchAction=function(e){e.preventDefault(),t.viewJSON.search.reset(),t.viewJSON.search.searchByKeyAndValue(e)}),t.resetAction||(t.resetAction=function(e){t.viewJSON.search.reset(),t.viewJSON.generate()}),this.hideAllButton.addEventListener("click",this.hideAllAction),this.resetButton.addEventListener("click",this.resetAction),this.actionsElement.addEventListener("submit",this.searchAction)}clearEvents(){this.hideAllButton.removeEventListener("click",this.hideAllAction),this.resetButton.removeEventListener("click",this.resetAction),this.actionsElement.removeEventListener("submit",this.searchAction)}generate(){return this.actionsElement||(this.actionsElement=document.createElement("form"),this.actionsElement.id=this.id,this.createHideAllButton(),this.createSearchForm(),this.actionsElement.appendChild(this.hideAllButton),this.actionsElement.appendChild(this.resetButton),this.actionsElement.appendChild(this.searchButton),this.actionsElement.appendChild(this.searchInput)),this.actionsElement}}
class ViewJSON{constructor(e=document.body,t=""){this.el=e,this.mainId="viewJsonMainBlock";try{this.json=JSON.parse(t),this.search=new Search(this),this.form=new FormAction(this),this.state=0,this.settings={},this.root=this.json}catch(e){this.errorMessage=e.message}}clickEventListener(e){if(/key/.test(e.target.className)){let t=e.target.parentNode,s=t.className.split(" "),i=s.indexOf("invisible");-1===i?(-1===(i=s.indexOf("visible"))&&(i=s.length),s[i]="invisible"):s[i]="visible",t.className=s.join(" ")}}getSettings(e){let t=this,s=new XMLHttpRequest;s.open("GET","data/settings.json",!0),s.send(),s.onreadystatechange=function(){4==s.readyState&&(200!=s.status?console.error(s.status+": "+s.statusText):(t.settings=JSON.parse(s.responseText),e()))}}numberToHTML(e){return`<span class="number">${e}</span>`}stringToHTML(e){return`<span class="string"><span class="quot">"</span>${e}<span class="quot">"</span></span>`}dateToHTML(e){return`<span class="boolean">${new Date(e).toDateString()}</span>`}booleanToHTML(e){return`<span class="boolean">${this.settings.boolAppearence[+e]}</span>`}nullToHTML(){return`<span class="null">${settings.nullAppearence}</span>`}undefinedToHTML(e){return`<span class="undefined">${e}</span>`}objectToHTML(e){let t="";t+='<ul class="objectProperties">';for(let s in e){let i=s;-1===this.settings.hidePropertiesByKey.indexOf(i)&&-1===this.settings.hidePropertiesByValue.indexOf(e)&&(this.settings.formatCamelCase&&(i=s.match(/((^[a-z])|[A-Z])[a-z]*/g).join(" ")),t+=`<li>${this.jsonToHTML(e[s],i)}</li>`)}return t}arrayToHTML(e,t){let s="",i=e.filter(e=>-1===this.settings.hidePropertiesByValue.indexOf(e));return s+='<ul class="arrayElements">',this.settings.keysForArrays[t]?s+=i.map((e,s)=>`<li class="element">${this.jsonToHTML(e,e[this.settings.keysForArrays[t]])}</li>`).join(""):s+=i.map((e,t)=>`<li class="element">${this.jsonToHTML(e,t)}</li>`).join(""),s+="</ul>"}arrayToTableHTML(e){let t="",s=e.filter(e=>-1===this.settings.hidePropertiesByValue.indexOf(e));t+='<table class="arrayElements">',t+="<thead><tr>";for(let e in s[0])-1===this.settings.hidePropertiesByKey.indexOf(e)&&(t+=`<th>${e}</th>`);return t+="</tr></thead>",t+="<tbody>",t+=s.map((e,t)=>{let s="<tr>";for(let t in e)-1===this.settings.hidePropertiesByKey.indexOf(t)&&(s+="<td>",e[t]&&"object"==typeof e[t]?s+="[Object]":s+=e[t]||this.settings.nullAppearence,s+="</td>");return s+="</tr>"}).join(""),t+="</tbody>",t+="</table>"}arrayToListHTML(e){}jsonToHTML(e=this.json,t){let s=typeof e,i="";if("object"===s){if(Array.isArray(e))s="array";else if(null===e&&(s="null",-1!==this.settings.hidePropertiesByValue.indexOf(null)))return i}else-1!==this.settings.dateAppearence.keys.indexOf(t)&&(s="date");return i+=`<div class="${s}">`,i+=void 0!==t?`<span class="key">${t}</span><span class="colon">:</span> `:"","array"===s?this.settings.arraysAsTable.includes(t)?i+=this.arrayToTableHTML(e):i+=this.arrayToHTML(e,t):i+=this[`${s}ToHTML`](e),i+="</div>"}hideObjectOrArray(e){let t=e.className.split(" "),s=t.indexOf("invisible");-1===s&&(-1===(s=t.indexOf("visible"))&&(s=t.length),t[s]="invisible"),e.className=t.join(" ")}hideAllJson(e=this.mainElement){let t,s,i=e.children[0];t=i.getElementsByClassName("object"),s=i.getElementsByClassName("array");for(let e=0;e<t.length;e++)this.hideObjectOrArray(t[e]);for(let e=0;e<s.length;e++)this.hideObjectOrArray(s[e])}hideAll(){this.state?this.search.hideAllSearchResults():this.hideAllJson()}generateJSON(e=this.root){this.mainElement.innerHTML=this.jsonToHTML(e),this.state=0}generate(){!this.form.actionsElement&&this.settings.showSearchPanel&&(this.el.appendChild(this.form.generate()),this.form.addEvents()),this.state&&(this.el.replaceChild(this.mainElement,this.search.searchResultsMainElement),this.state=0),this.hideAll()}render(){let e=this;this.json?(this.el.innerHTML="",this.mainElement=document.createElement("div"),this.mainElement.id=this.mainId,this.getSettings(function(){if(e.settings.root){let t=e.settings.root.split("/");for(let s=0;s<t.length;s++)e.root=e.root[t[s]]}e.generateJSON(),e.generate(),e.el.appendChild(e.mainElement),e.addEvents()})):this.el.innerHTML=`<div id="jsonParseError"><p>There is an error in json file</p><p>Error message: ${this.errorMessage}</p></div>`}addEvents(){this.mainElement.addEventListener("click",this.clickEventListener)}clearEvents(){this.mainElement.removeEventListener("click",this.clickEventListener)}clear(){this.el.innerHTML="",this.search.clearEvents(),this.clearEvents(),delete this.mainElement,delete this.search.searchResultsMainElement}}